# PropVerified v1 Scope - Prop Firm Analytics (SIMPLIFIED)

## Overview
v1 extends the transaction tracking system to support **prop firm analytics**. While v0 focused on individual trader payouts (money received), v1 focuses on prop firm payouts (money sent to traders).

## Key Principles
- **Minimal complexity** - No database, no caching, no complex error handling
- **Hardcoded data** - Single test prop firm with hardcoded addresses (like v0)
- **Real blockchain data** - Fetch outgoing transactions from Arbitrum via Arbiscan API
- **Fast to build** - 2-3 days total
- **Validate concept first** - Prove outgoing transaction tracking works before adding database

## Key Differences from v0

| Feature | v0 (Trader View) | v1 (Prop Firm View) |
|---------|-----------------|-------------------|
| **Data Direction** | Incoming transactions (money received) | Outgoing transactions (money sent) |
| **Address Management** | Single hardcoded address | Multiple hardcoded addresses |
| **Use Case** | Track trader payouts | Track firm distributions to traders |
| **Time Range** | All-time + last 30 days | Last 7 days (default) |
| **Stats Focus** | Total received, avg payout | Total sent, payout count, time since last |

---

## What We're Building

### 1. Single Prop Firm Detail Page
**Route:** `/propfirm/fundingpips` (new page, hardcoded slug)

**Hardcoded Test Data:**
```javascript
const TEST_FIRM = {
  name: "FundingPips",
  addresses: [
    "0x1C969652D758f8Fc23C443758f8911086F676216",
    "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb"
    // Add 2-3 real addresses with outgoing transactions
  ]
};
```

**Features:**
- **Stats Cards** (similar to v0 but adapted):
  - **Total Payouts** - Sum of all outgoing USD value
  - **Number of Payouts** - Count of transactions
  - **Largest Single Payout** - Max transaction amount
  - **Time Since Last Payout** - Human readable (e.g., "4hr & 8min")

- **Chart - Total Payouts** (last 7 days default):
  - Stacked bar chart showing daily totals
  - Breakdown by payment method (Rise/Crypto/Wire Transfer)
  - Dropdown to change time range (7, 30 days)

- **Top 10 Largest Single Payouts**:
  - List of largest transactions
  - Show date, amount, payment method

- **Latest Payouts Table**:
  - Show recent transactions (last 24 hours default)
  - Columns: Time ago, Amount, Token, Tx Hash (link to Arbiscan)
  - Pagination: "1 - 13 of 13" with prev/next

**Data fetching:**
- Fetch transactions for **all hardcoded addresses**
- Aggregate and merge results
- Filter for **outgoing** transactions only (from === firmAddress)
- Default to **last 7 days** (configurable)

---

### 2. API Endpoint

#### New Endpoint: `/api/propfirm-transactions`
**Query params:**
- `addresses` - Comma-separated list of addresses
- `days` - Number of days to look back (default: 7)

**What it does:**
- Fetch outgoing transactions for multiple addresses
- Filter by direction: `from === targetAddress` (opposite of v0)
- Filter by time range (last N days)
- Aggregate stats across all addresses
- Return combined transaction list

**Response structure:**
```json
{
  "addresses": ["0xabc...", "0xdef..."],
  "days": 7,
  "totalPayoutUSD": 850000,
  "totalPayoutCount": 150,
  "largestPayoutUSD": 140354,
  "timeSinceLastPayout": "4hr 8min",
  "transactions": [
    {
      "txHash": "0xabc123...",
      "timestamp": 1717574400,
      "date": "2024-06-15T10:00:00Z",
      "to": "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb",
      "toShort": "0x742d...0bEb",
      "amount": "56",
      "amountUSD": 140000,
      "token": "ETH",
      "paymentMethod": "Crypto",
      "arbiscanUrl": "https://arbiscan.io/tx/0xabc123..."
    }
  ],
  "dailyData": [
    {
      "date": "2025-01-17",
      "totalUSD": 850000,
      "rise": 200000,
      "crypto": 550000,
      "wireTransfer": 100000
    }
  ],
  "topPayouts": [...],
  "latestPayouts": [...]
}
```

---

## Technical Implementation

### File Structure
```
app/propfirm/fundingpips/page.js           # Hardcoded firm detail page
app/api/propfirm-transactions/route.js     # Fetch outgoing transactions
lib/transactionProcessor.js                # Update to support outgoing txs
lib/hooks/usePropFirmTransactions.js       # React hook for firm data
```

---

### Key Functions

**lib/transactionProcessor.js (UPDATE):**
```javascript
export function processOutgoingTransactions(nativeData, tokenData, sourceAddresses, days) {
  // Similar to v0 but filter for outgoing (from === sourceAddress)
  // Support multiple source addresses
  // Filter by time range (last N days)
  // Group and aggregate across all addresses
}

export function calculatePropFirmStats(transactions) {
  return {
    totalPayoutUSD: ...,
    totalPayoutCount: transactions.length,
    largestPayoutUSD: Math.max(...transactions.map(t => t.amountUSD)),
    timeSinceLastPayout: calculateTimeSince(transactions[0]?.timestamp)
  };
}

export function groupByDay(transactions, days = 7) {
  // Group transactions by day for last N days
  // Include breakdown by payment method (placeholder - all "Crypto")
}

export function calculateTimeSince(timestamp) {
  // Return human-readable string like "4hr 8min"
}
```

**app/api/propfirm-transactions/route.js:**
```javascript
export async function GET(request) {
  const { searchParams } = new URL(request.url);
  const addressesParam = searchParams.get('addresses'); // "0xabc,0xdef"
  const days = parseInt(searchParams.get('days') || '7');

  const addresses = addressesParam.split(',');
  const apiKey = process.env.ARBISCAN_API_KEY;

  // Fetch transactions for each address
  const allNativeTxs = [];
  const allTokenTxs = [];

  for (const address of addresses) {
    const native = await fetchNativeTransactions(address, apiKey);
    const token = await fetchTokenTransactions(address, apiKey);
    allNativeTxs.push(...native);
    allTokenTxs.push(...token);
  }

  // Process outgoing transactions
  const transactions = processOutgoingTransactions(
    allNativeTxs,
    allTokenTxs,
    addresses,
    days
  );

  const stats = calculatePropFirmStats(transactions);
  const dailyData = groupByDay(transactions, days);

  return NextResponse.json({
    addresses,
    days,
    ...stats,
    transactions,
    dailyData
  });
}
```

---

## UI/UX Design Notes

### Prop Firm Detail Page (`/propfirm/fundingpips`)
- **Match the design from the screenshot** (similar to v0 trader page)
- Replace "trader" terminology with "firm"
- Add time range selector (7 days, 30 days)
- Change chart to show outgoing payments
- Tables show payments TO traders (not FROM firms)
- Hardcode firm name "FundingPips" at top

---

## Out of Scope (v1)

### Explicitly NOT Building:
- ❌ Database (Supabase) - hardcode data only
- ❌ Prop firm list page - single firm only
- ❌ CRUD operations - no add/edit/delete
- ❌ Authentication (still internal testing)
- ❌ Payment method auto-detection (manually categorize later)
- ❌ Trader identification (just show addresses)
- ❌ Advanced filtering/search
- ❌ Export functionality
- ❌ Historical comparisons
- ❌ Email notifications

---

## Success Criteria

### v1 is successful if:
1. ✅ Firm detail page shows accurate outgoing transaction stats for multiple addresses
2. ✅ Chart displays daily payout totals for last 7 days
3. ✅ Table shows recent payouts with Arbiscan links
4. ✅ Stats correctly aggregate across all firm addresses
5. ✅ Time since last payout calculates correctly
6. ✅ Can verify data manually against Arbiscan

### Acceptable trade-offs for v1:
- ⚠️ Still using constant USD prices ($2500 ETH) - same as v0
- ⚠️ No caching - fresh data each request
- ⚠️ Payment method breakdown is placeholder (all "Crypto")
- ⚠️ Limited to 100 transactions per address
- ⚠️ 3-5 second load times acceptable
- ⚠️ Single hardcoded firm only (no database)

---

## Reusable Components from v0

We can **reuse** most of v0's infrastructure:
- ✅ Arbiscan API helper (`lib/arbiscan.js`)
- ✅ USD conversion logic (`lib/transactionProcessor.js`)
- ✅ Transaction data structures
- ✅ Chart components (adapt for outgoing data)
- ✅ UI components (stat cards, tables)

**Key changes:**
- Filter direction: `from === address` instead of `to === address`
- Support multiple addresses (array instead of single address)
- Different time range defaults (7 days vs 30 days)

---

## Environment Variables

Same as v0, no changes needed:
```env
ARBISCAN_API_KEY=your_api_key_here
```

---

## Timeline

**Total: 2-3 days**

### Day 1: API Development
- Update transaction processor for outgoing txs
- Add multi-address support
- Create propfirm-transactions API endpoint
- Test with multiple addresses

### Day 2: Frontend Integration
- Create firm detail page (similar to v0 trader page)
- React hook for multi-address data
- Stats cards
- Daily payouts chart

### Day 3: Tables & Testing
- Top 10 payouts table
- Latest payouts table
- Manual testing & verification
- Code cleanup

---

## Technical Debt for Phase 2

⚠️ **Still pending from v0:**
1. Historical USD prices (CoinGecko)
2. Caching layer
3. Error handling & retry logic
4. Rate limiting

⚠️ **New for v2:**
1. Database integration (add Supabase for prop firm management)
2. CRUD operations for firms and addresses
3. Prop firm list page
4. Payment method auto-detection
5. Trader identification
6. Multi-user authentication

---

## Notes

- This builds directly on v0's foundation
- Focus on **outgoing** vs **incoming** transactions
- Support **multiple addresses** (hardcoded array)
- Default to **shorter time ranges** (7 days vs 30 days)
- UI should feel familiar to v0 but adapted for firm use case
- Reference screenshot for layout inspiration
- **No database** - prove the concept works first
- Keep it simple like v0 - just validate that outgoing transaction tracking works
